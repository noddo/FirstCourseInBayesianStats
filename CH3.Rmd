---
title: "CH3"
author: "Nick Oddo"
date: "2024-08-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)

```

## 3.1 
Sample survey: Suppose we are going to sample 100 individuals from
a county (of size much larger than 100) and ask each sampled person
whether they support policy $Z$ or not. Let $Y_i = 1$ if person $i$ in the sample
supports the policy, and $Y_i = 0$ otherwise.

a. Assume $Y_1,\ldots, Y_{100}$ are, conditional on $\theta$, i.i.d. binary random variables with expectation $\theta$. 
Write down the joint distribution of $Pr(Y_1 = y_1, . . . , Y_{100} = y_{100}|\theta)$ in a compact form.
Also write down the form of $P(\sum Y_i = y|\theta)$.

The joint distribution (likelihood) of $Pr(Y_1 = y_1, . . . , Y_{100} = y_{100}|\theta)$ is:
\begin{align}
 &Pr(Y_1 = y_1, . . . , Y_{100} = y_{100}|\theta) = \prod p^{y_i} \cdot (1-p)^{(1-y_i)}\\
 &=  p^{\sum_{i=1}^{100} y_i} \cdot (1-p)^{(100-\sum_{i=1}^{100} y_i)}

\end{align}


as for $P(\sum Y_i = y|\theta)$, let $Z = \sum Y_i $. Then:
\begin{align}

&P(\sum Y_i = y|\theta) = P(Z = z|\theta)\\
&= \binom{100}{z} p^{z}(1-p)^{100-z}

\end{align}


b. For the moment, suppose you believed that $\theta \in {0.0, 0.1,\ldots , 0.9, 1.0}$.
Given that the results of the survey were $\sum_{i=1}^{100} = 57$ compute $P(\sum Yi = 57|\theta)$ for each of these 11 values of $\theta$ and plot these probabilities as a function of $\theta$.

```{r}

theta = seq(from = 0, to = 1, length.out = 11)
probs = dbinom(x = 57, size = 100,prob = theta)

data.frame(theta,"probs" = round(probs,4))

plot(theta,probs, type = "b")

```


c. Now suppose you originally had no prior information to believe one of
these $\theta$-values over another, and so $Pr(\theta = 0.0) = Pr(\theta = 0.1) = · · · =Pr(\theta = 0.9) = Pr(\theta = 1.0)$.
Use Bayes’ rule to compute $p(\theta|\sum_i=1 Yi =57)$ for each $\theta$-value. Make a plot of this posterior distribution as a
function of $\theta$.

Using a discrete uniform prior $p(\theta) = \frac{1}{11}$, and using $Y = \sum_{i=1}^{100} Y_i$:

\begin{align}
&P(\theta | Y = 57) \\
&= \frac{ P(Y = 57 | \theta)P(\theta)}{\sum_{j=1}^{11} P(Y = 57 |\theta_j)P(\theta_j) }\\
&=\frac{\binom{100}{57} \theta^{57}(1-\theta)^{43} \cdot \frac{1}{11} }{ \sum_{j=1}^{11} \binom{100}{57}(\frac{1}{11})^{57}(\frac{10}{11})^{43} \cdot (\frac{1}{11})}\\
\end{align}

```{r}

thetas.c = seq(from = 0, to = 1, length.out = 11)
my_post<-function(theta){ (dbinom(57,100,theta)*(1/11))/(sum(dbinom(57,100,theta))*(1/11)) }

data.frame(thetas.c,"probs" = round(my_post(thetas.c),4))

plot(thetas.c,my_post(thetas.c),type = 'b')

```


d. Now suppose you allow $\theta$ to be any value in the interval $[0, 1]$. Using
the uniform prior density for $\theta$, so that $p(\theta) = 1$, plot the posterior
density $p(θ) P(\sum_{i=1}^{100} Y_i = 57|θ)$ as a function of $\theta$.


```{r}

thetas.d = seq(from = 0, to = 1, length.out = 1000)
my_post<-function(theta){ (dbinom(57,100,theta)*(1/11))/(sum(dbinom(57,100,theta))*(1/11)) }

# data.frame(thetas.d,"probs" = my_post(thetas.d))

plot(thetas.d,my_post(thetas.d),type = 'l',xlab = 'theta', ylab = 'posterior prob')

```

e. As discussed in this chapter, the posterior distribution of θ is beta(1+
57, 1 + 100−57). Plot the posterior density as a function of θ. Discuss
the relationships among all of the plots you have made for this exercise.

Assuming a flat prior ($\theta \sim Beta(1,1)$) where $f(\theta) = 1 $ the posterior becomes $\theta|\mathcal{D} \sim Beta(y+1,100-y+1)$. So, 

```{r}

thetas.e = seq(0,1,length.out = 900)

post.probs.e = dbeta(thetas.e,57+1,100-57+1)

plot(thetas.e,post.probs.e,type = 'l')

```

# 3.2 
Sensitivity analysis: It is sometimes useful to express the parameters $a$ and $b$ in a beta distribution in terms of $\theta_0 = \frac{a}{a+b}$ and $n_0 = a+b$, so that $a = \theta_0n_0$ and $b = (1 − \theta_0)n_0$. Reconsidering the sample survey data in Exercise 3.1, for each combination of $\theta_0 \in \{0.1, 0.2, \ldots, 0.9\}$ and $n_0 \in \{1, 2, 8, 16, 32\}$ find the corresponding $a$, $b$ values and compute $P(\theta >0.5| \sum_{i=1}^{100} Y_i = 57)$ using a beta(a, b) prior distribution for $\theta$. Display the results with a contour plot, and discuss how the plot could be used to explain to someone whether or not they should believe that $\theta > 0.5$, based on the data that $\sum_{i=1}^{100} Y_i = 57$.


```{r}

theta0s = seq(from = .1, to = .9, by = .1)
n0s = c(1,2,8,16,32)

params.3.2 = data.frame(expand.grid(theta0s,n0s),"probs1" = 0); colnames(params.3.2) = c("theta_0", "n_0","P(theta>.5|Y=57)")

for (i in 1:nrow(params.3.2)){
  
  theta0 = params.3.2[i,"theta_0"]
  n0 = params.3.2[i,"n_0"]
  
  post.samples = rbeta(1000,57+(theta0*n0)-1,43+(1-theta0)*n0-1)
  
  params.3.2[i,"P(theta>.5|Y=57)"]<- mean(post.samples > .5)

}

ggplot( data = params.3.2, aes(x = `theta_0`, y = `n_0`, z = `P(theta>.5|Y=57)` )) +
  geom_contour_filled()

```





