---
title: "CH5-2"
author: "Nick Oddo"
date: "2024-08-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### 5.2
Sensitivity analysis: Thirty-two students in a science classroom were
randomly assigned to one of two study methods, A and B, so that
$n_A$ = $n_B$ = 16 students were assigned to each method. After several
weeks of study, students were examined on the course material with an
exam designed to give an average score of 75 with a standard deviation of
10. The scores for the two groups are summarized by ${\bar{y}_A = 75.2, S_A = 7.3}$
and ${\bar{y}_B = 77.5, S_B = 8.1}$. Consider independent, conjugate normal prior
distributions for each of $\theta_A$ and $\theta_B$, with $\mu_0 = 75$ and $\sigma_0^2 = 100$ for
both groups. For each $(\kappa_0, \nu_0) \in {(1,1),(2,2),(4,4),(8,8),(16,16),(32,32)}$
(or more values), obtain $Pr(\theta_A < \theta_B|\mathbf{y}_A, \mathbf{y}_B)$ via Monte Carlo sampling.
Plot this probability as a function of $(\kappa_0 = \nu_0)$. Describe how you might
use this plot to convey the evidence that $\theta_A < \theta_B$ to people of a variety
of prior opinions.

Build function to sample from posterior distributions for $\theta$ (mean). `norm.norm.post.theta`

```{r echo = FALSE}

#function to sample from posterior dist. of theta- Peter Hoff parameterization
norm.norm.post.theta <- function(x, k0 ,mu0 ,v0 ,sigma0, s2 = NULL, num.samples = 1000 ){
  n = length(x)
  xbar = mean(x)
  
  if(is.null(s2)){
    s2 = var(x)
  }

#posterior parameters
#mu|data:
  kn = k0 + n
  mun = (k0*mu0 + n*xbar)/kn

# sigma|data:
    vn = v0 + n
    sigma_n = 1/vn * (v0*sigma0 + (n-1)*s2 + (xbar - mu0)^2*k0*n/kn)

#Sample posterior distributions
  sigma = 1/rgamma(num.samples, vn/2, sigma_n*vn/2)
  mu = rnorm(num.samples, mun, sqrt(sigma_n/kn))

return(mu)
}

```

sample data using $\theta_0 = 75, \sigma_0^2 = 100$ and a variety of different prior $\sigma^2_0$ specifications.

```{r}

sigma.params = c(1,2,4,8,16,32)

p = data.frame('(k0,v0)'= 0, 'P(thetaA < thetaB)' = 0); colnames(p) = c('(k0,v0)','P(thetaA < thetaB)')


for (i in 1:length(sigma.params)){
  k0 <- v0 <- sigma.params[i]
  
  p[i,1] = paste('(',k0,',',v0,')',sep = '') 

  post.samples.A = norm.norm.post.theta(x =75.2,s2 = (7.3)^2, mu0 = 75 , sigma0 = 100, k0 = k0, v0 = v0)
  post.samples.B = norm.norm.post.theta(x =77.5,s2 = (8.1)^2, mu0 = 75 , sigma0 = 100, k0 = k0, v0 = v0)

  p[i,2] = mean( ifelse(post.samples.A < post.samples.B, 1.0, 0.0) )
  
}

p

plot(sigma.params,p$`P(thetaA < thetaB)`, type = 'b')

```

